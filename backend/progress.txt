
## 2026-01-19 - Core Pydantic Models Implementation (wsim-vbx)

Implemented the foundational Pydantic v2 models for the WSIM game engine:

### Models Created:
- **Common Enums**: Side, Facing (8 directions), WindDirection, LoadState, GamePhase, Broadside, AimPoint
- **HexCoord**: Hex coordinate model with hash support for use as dict keys
- **Ship**: Complete ship state including:
  - Identity (id, name, side)
  - Position (bow_hex, stern_hex, facing)
  - Movement stats (battle_sail_speed)
  - Combat stats (guns_L/R, carronades_L/R)
  - Tracks (hull, rigging, crew, marines)
  - Load state (load_L/R)
  - Status flags (fouled, struck)
  - Drift tracking (turns_without_bow_advance)
- **Orders**: ShipOrders and TurnOrders for movement planning phase
- **Events**: DiceRoll and EventLogEntry for comprehensive audit trail
- **Game**: Complete game state with ships dict, wind, phase, event log, and helper methods

### Test Coverage:
- Created 39 comprehensive tests covering all models
- Tests include validation, edge cases, and model interactions
- All tests passing

### Quality Checks:
- ✅ Ruff formatting and linting (all checks passed)
- ✅ Ty type checking (all checks passed)
- ✅ All pytest tests passing (39/39)

### Configuration:
- Added per-file linting exception for Ship model (_L/_R suffix is domain convention)
- Configured ty overrides for test files to handle dynamic dict unpacking

This provides the solid foundation for all other game engine components.

## 2026-01-19 - Scenario Loader Implementation (wsim-wgw)

Implemented comprehensive scenario loading system to initialize games from JSON scenario files:

### Components Created:
- **Scenario Models** (scenario.py):
  - MapConfig, WindConfig, VictoryConfig
  - ShipStartPosition, ShipGuns, ShipCarronades, ShipInitialLoad
  - ScenarioShip: Complete ship definition for scenarios
  - Scenario: Top-level model with validation methods for ship ID uniqueness and map bounds

- **Scenario Loader** (scenario_loader.py):
  - load_scenario_from_file(): Load and validate from JSON files
  - load_scenario_from_dict(): Load and validate from dictionaries
  - initialize_game_from_scenario(): Convert Scenario to Game state
  - _calculate_stern_hex(): Calculate stern position based on bow and facing for all 8 directions
  - ScenarioLoadError: Custom exception for loading failures

### MVP Scenarios Created:
1. **Frigate Duel** (mvp_frigate_duel_v1.json): 1v1 frigate fight for learning basics
2. **Crossing Paths** (mvp_crossing_paths_v1.json): 2v2 sloops testing collision/fouling
3. **Two-Ship Line Battle** (mvp_two_ship_line_battle_v1.json): 2v2 mixed ships testing closest-target rule

### Test Coverage:
- Created 14 comprehensive tests covering:
  - Valid scenario loading from dict and file
  - Optional field handling
  - Validation error cases (missing fields, invalid enums)
  - Duplicate ship ID detection
  - Out of bounds ship detection
  - File I/O error handling (nonexistent files, invalid JSON)
  - Game initialization from scenarios
  - Stern hex calculation for all 8 facing directions
  - Loading all 3 real MVP scenario files
- All tests passing (14/14)

### Quality Checks:
- ✅ Ruff formatting and linting (all checks passed)
- ✅ Ty type checking (all checks passed)
- ✅ All pytest tests passing (14/14)

The scenario system is now complete and ready for use by the API layer to create games.

## 2026-01-19 - Movement Parser Implementation (wsim-7c6)

Implemented comprehensive movement notation parser that converts high-level movement strings into atomic actions:

### Components Created:
- **MovementActionType Enum**: Defines atomic action types (TURN_LEFT, TURN_RIGHT, MOVE_FORWARD, NO_MOVEMENT)
- **MovementAction Model**: Represents a single atomic movement action with optional distance for forward moves
- **ParsedMovement Model**: Result of parsing containing original notation, action sequence, and total forward hexes
- **parse_movement()**: Main parser function that:
  - Accepts notation like 'L1R1', '0', 'LLR2', 'R', '3'
  - Normalizes input (strips whitespace, converts to uppercase)
  - Validates syntax character by character
  - Expands digits into forward movement actions
  - Calculates total forward movement distance
  - Provides detailed error messages with character positions
- **validate_movement_within_allowance()**: Validates parsed movement doesn't exceed ship's movement allowance
- **MovementParseError**: Custom exception for parsing failures

### Movement Notation Rules:
- '0': No movement (can only appear alone)
- 'L': Turn left (60 degrees)
- 'R': Turn right (60 degrees)
- '1'-'9': Move forward that many hexes
- Combinations: 'L1R1' = turn left, move 1, turn right, move 1
- Case-insensitive with whitespace trimming

### Test Coverage:
- Created 29 comprehensive tests covering:
  - All basic notation types (turns, forward movement, no movement)
  - Complex sequences and combinations
  - Input normalization (lowercase, whitespace)
  - Movement allowance validation
  - Error cases (empty strings, invalid characters, '0' in sequences)
  - Pydantic model validation (negative distances, negative totals)
- All tests passing (29/29)

### Quality Checks:
- ✅ Ruff formatting and linting (all checks passed)
- ✅ Ty type checking (all checks passed)
- ✅ All pytest tests passing (84/84 total suite)

The movement parser is now complete and provides the foundation for the movement execution engine.
